<?xml version="1.0"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009"
                       xmlns:s="library://ns.adobe.com/flex/spark"
                       xmlns:local="*"
                       width="1136" height="640" showStatusBar="false" frameRate="60"
                       creationComplete="onCreationComplete(event)">
    <fx:Script>
        import mx.events.FlexEvent;

        private var drag:Point = null;

        private function onCreationComplete(event:FlexEvent):void {
            systemManager.stage.addEventListener(Event.ENTER_FRAME, onFrame);
            systemManager.stage.addEventListener(MouseEvent.MOUSE_DOWN, onMouseDown);
            systemManager.stage.addEventListener(MouseEvent.MOUSE_UP, onMouseUp);
            systemManager.stage.addEventListener(Event.RESIZE, onResize);
        }

        private function onResize(event:Event):void {
            constrain();
        }

        private function onFrame(event:Event):void {
            if (drag) {
                // Drag
                var newX:Number = systemManager.stage.mouseX - drag.x;
                var newY:Number = systemManager.stage.mouseY - drag.y;
                map.x += (newX - map.x) / 5;
                map.y += (newY - map.y) / 5;
                constrain();
            }
        }

        private function constrain():void {
            // Constrain
            if (map.x > 0)
                map.x = 0;
            if (map.y > 0)
                map.y = 0;
            if (width - map.width > map.x)
                map.x = width - map.width;
            if (height - map.height > map.y)
                map.y = height - map.height;
        }

        private function onMouseDown(event:MouseEvent):void {
            drag = map.mouse;
        }

        private function onMouseUp(event:MouseEvent):void {
            drag = null;
        }
    </fx:Script>

    <local:Map id="map" cacheAsBitmap="true"
               width="2272" height="1280" includeInLayout="false"/>
    <!--width="1136" height="640" includeInLayout="false"/>-->
    <s:Group width="100%">
        <s:Rect width="100%" height="100%">
            <s:fill>
                <s:SolidColor color="0x000000" alpha=".6"/>
            </s:fill>
        </s:Rect>
        <s:Label width="100%" color="white" top="20" bottom="20" left="20" right="20"
                 text="Q: Outlines  W: Rivers  E: Temperature  R: Regenerate random map  T: Terrain  P: Precipitation  B: Biomes  F: Forests"/>
    </s:Group>

</s:WindowedApplication>